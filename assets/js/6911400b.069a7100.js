"use strict";(self.webpackChunkripple=self.webpackChunkripple||[]).push([[2967],{5162:(e,t,n)=>{n.d(t,{Z:()=>r});var a=n(7294),l=n(6010);const i={tabItem:"tabItem_Ymn6"};function r(e){let{children:t,hidden:n,className:r}=e;return a.createElement("div",{role:"tabpanel",className:(0,l.Z)(i.tabItem,r),hidden:n},t)}},4866:(e,t,n)=>{n.d(t,{Z:()=>y});var a=n(7462),l=n(7294),i=n(6010),r=n(2466),o=n(6550),s=n(1980),u=n(7392),p=n(12);function c(e){return function(e){return l.Children.map(e,(e=>{if(!e||(0,l.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}(e).map((e=>{let{props:{value:t,label:n,attributes:a,default:l}}=e;return{value:t,label:n,attributes:a,default:l}}))}function d(e){const{values:t,children:n}=e;return(0,l.useMemo)((()=>{const e=t??c(n);return function(e){const t=(0,u.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function h(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function m(e){let{queryString:t=!1,groupId:n}=e;const a=(0,o.k6)(),i=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,s._X)(i),(0,l.useCallback)((e=>{if(!i)return;const t=new URLSearchParams(a.location.search);t.set(i,e),a.replace({...a.location,search:t.toString()})}),[i,a])]}function b(e){const{defaultValue:t,queryString:n=!1,groupId:a}=e,i=d(e),[r,o]=(0,l.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!h({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const a=n.find((e=>e.default))??n[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:t,tabValues:i}))),[s,u]=m({queryString:n,groupId:a}),[c,b]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[a,i]=(0,p.Nk)(n);return[a,(0,l.useCallback)((e=>{n&&i.set(e)}),[n,i])]}({groupId:a}),g=(()=>{const e=s??c;return h({value:e,tabValues:i})?e:null})();(0,l.useLayoutEffect)((()=>{g&&o(g)}),[g]);return{selectedValue:r,selectValue:(0,l.useCallback)((e=>{if(!h({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);o(e),u(e),b(e)}),[u,b,i]),tabValues:i}}var g=n(2389);const f={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function v(e){let{className:t,block:n,selectedValue:o,selectValue:s,tabValues:u}=e;const p=[],{blockElementScrollPositionUntilNextRender:c}=(0,r.o5)(),d=e=>{const t=e.currentTarget,n=p.indexOf(t),a=u[n].value;a!==o&&(c(t),s(a))},h=e=>{let t=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const n=p.indexOf(e.currentTarget)+1;t=p[n]??p[0];break}case"ArrowLeft":{const n=p.indexOf(e.currentTarget)-1;t=p[n]??p[p.length-1];break}}t?.focus()};return l.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":n},t)},u.map((e=>{let{value:t,label:n,attributes:r}=e;return l.createElement("li",(0,a.Z)({role:"tab",tabIndex:o===t?0:-1,"aria-selected":o===t,key:t,ref:e=>p.push(e),onKeyDown:h,onClick:d},r,{className:(0,i.Z)("tabs__item",f.tabItem,r?.className,{"tabs__item--active":o===t})}),n??t)})))}function k(e){let{lazy:t,children:n,selectedValue:a}=e;const i=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=i.find((e=>e.props.value===a));return e?(0,l.cloneElement)(e,{className:"margin-top--md"}):null}return l.createElement("div",{className:"margin-top--md"},i.map(((e,t)=>(0,l.cloneElement)(e,{key:t,hidden:e.props.value!==a}))))}function I(e){const t=b(e);return l.createElement("div",{className:(0,i.Z)("tabs-container",f.tabList)},l.createElement(v,(0,a.Z)({},e,t)),l.createElement(k,(0,a.Z)({},e,t)))}function y(e){const t=(0,g.Z)();return l.createElement(I,(0,a.Z)({key:String(t)},e))}},7263:(e,t,n)=>{n.d(t,{Z:()=>o});var a=n(7294),l=n(4866),i=n(5162),r=n(7693);function o(e){return a.createElement(l.Z,null,e.items.map(((t,n)=>{let{label:l,code:o,language:s,ms:u,maxHeight:p}=t;return a.createElement(i.Z,{value:`v-${n}`,label:l},a.createElement("div",{style:{maxHeight:p||"",overflowY:"auto",border:"0px solid red"}},a.createElement(r.Z,{metastring:`{${u}}`,language:s,showLineNumbers:e.lineNumbers},`${atob(o)}`)))})))}},2182:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>p});var a=n(7462),l=(n(7294),n(3905)),i=n(7263);const r={sidebar_position:3},o="Deep dive into ripples",s={unversionedId:"Ripple123/Deep-Dive",id:"Ripple123/Deep-Dive",title:"Deep dive into ripples",description:"Intro",source:"@site/docs/Ripple123/03-Deep-Dive.mdx",sourceDirName:"Ripple123",slug:"/Ripple123/Deep-Dive",permalink:"/docs/Ripple123/Deep-Dive",draft:!1,tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Ripple Lake",permalink:"/docs/Ripple123/Ripple-Lake"},next:{title:"Update from a component",permalink:"/docs/Ripple123/Update-From-Component"}},u={},p=[{value:"Intro",id:"intro",level:3},{value:"Inside the component",id:"inside-the-component",level:3},{value:"Destructuring the ripple",id:"destructuring-the-ripple",level:3},{value:"Behind the scene",id:"behind-the-scene",level:3}],c={toc:p},d="wrapper";function h(e){let{components:t,...n}=e;return(0,l.kt)(d,(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"deep-dive-into-ripples"},"Deep dive into ripples"),(0,l.kt)("h3",{id:"intro"},"Intro"),(0,l.kt)("p",null,"A ripple represents an object, similar to an Atom in Recoil. A ripple is declared into the Lake using the ",(0,l.kt)("inlineCode",{parentName:"p"},"createRipples")," function.\nIt takes a name and an object that represent the Ripple and its initial state."),(0,l.kt)("p",null,"When you use a Ripple from a component, you receive a copy of the Ripple state and a set function to update the state.\nThe Ripple object can be locally modified by the component, but the changes will not be reflected in the Lake."),(0,l.kt)("p",null,"The Ripple source is immutable, but the changes are propagated to the Lake via the updater, then modifications are propagated to all the components that use the Ripple."),(0,l.kt)("p",null,"Let's imagine the following Ripple definition:"),(0,l.kt)(i.Z,{lineNumbers:!0,items:[{label:"my-lake.ts",language:"tsx",ms:"2-4",code:"Li4uID0gY3JlYXRlUmlwcGxlKHsgLy8gTGFrZQogIGNvdW50ZXI6IHsgLy8gQ291bnRlciByaXBwbGUKICAgIGNvdW50OiAwLAogIH07Cn0pOw=="}],mdxType:"Code"}),(0,l.kt)("p",null,"We have a small Ripple that contains a single property, ",(0,l.kt)("inlineCode",{parentName:"p"},"count"),", initialized to 0."),(0,l.kt)("h3",{id:"inside-the-component"},"Inside the component"),(0,l.kt)("p",null,"We can use this Ripple in a component:"),(0,l.kt)(i.Z,{lineNumbers:!0,items:[{label:"MyComponent ",language:"tsx",ms:"2,5,9",code:"aW1wb3J0IHsgcmlwcGxlSG9va3MgfSBmcm9tICcuL215LWxha2UnOwpjb25zdCB7IHVzZUNvdW50ZXIgfSA9IHJpcHBsZUhvb2tzOwoKY29uc3QgTXlDb21wb25lbnQgPSAoKSA9PiB7CiAgY29uc3QgW2NvdW50ZXIsIC8qLi4udXBkYXRlckhvb2suLi4qL10gPSB1c2VDb3VudGVyKCk7CgogIHJldHVybiAoCiAgICA8ZGl2PgogICAgICA8cD5Db3VudGVyOiB7Y291bnRlci5jb3VudH08L3A+CiAgICA8L2Rpdj4KICApOwp9Ow=="}],mdxType:"Code"}),(0,l.kt)("p",null,"The ",(0,l.kt)("inlineCode",{parentName:"p"},"useCounter")," hook returns a tuple with the Ripple state and the updater function."),(0,l.kt)("admonition",{title:"Reminder",type:"info"},(0,l.kt)("p",{parentName:"admonition"},"Remind that the ripple source is immutable, so we can't do ",(0,l.kt)("inlineCode",{parentName:"p"},"counter.count++")," directly and have the modification applied.\nBut we can do ",(0,l.kt)("inlineCode",{parentName:"p"},"counter.count++")," and then call the updater function to propagate the changes to the Lake.\nThe source value remains unchanged, but the Lake will be updated with the new value.")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"We will study the updater in the next chapter.")),(0,l.kt)("h3",{id:"destructuring-the-ripple"},"Destructuring the ripple"),(0,l.kt)("p",null,"As a Ripple is linked to the lake internally, you can destructure a ripple and still be rerendered when the ripple changes."),(0,l.kt)(i.Z,{lineNumbers:!0,items:[{label:"MyComponent (destructuring)",language:"tsx",ms:"2,5,6,10,12,13",code:"aW1wb3J0IHsgcmlwcGxlSG9va3MgfSBmcm9tICcuL215LWxha2UnOwpjb25zdCB7IHVzZUNvdW50ZXIgfSA9IHJpcHBsZUhvb2tzOwoKY29uc3QgTXlDb21wb25lbnQgPSAoKSA9PiB7CiAgY29uc3QgW2NvdW50ZXIsIHNldENvdW50ZXJdID0gdXNlQ291bnRlcigpOwogIGNvbnN0IHsgY291bnQgfSA9IGNvdW50ZXI7CgogIHJldHVybiAoCiAgICA8ZGl2PgogICAgICA8cD5Db3VudGVyOiB7Y291bnR9PC9wPgogICAgICA8YnV0dG9uIG9uQ2xpY2s9eygpID0+IHsKICAgICAgICBjb3VudGVyLmNvdW50Kys7CiAgICAgICAgc2V0Q291bnRlcigpOwogICAgICB9fT5JbmNyZW1lbnQ8L2J1dHRvbj4KICAgIDwvZGl2PgogICk7Cn07"}],mdxType:"Code"}),(0,l.kt)("p",null,"Obviously, in this example, it takes more line of code to destructure the ripple than to use it directly, but the purpose is just to explain what you can do.\nLocal modifications can be cancelled or applied to the Lake using the updater function."),(0,l.kt)("h3",{id:"behind-the-scene"},"Behind the scene"),(0,l.kt)("admonition",{type:"info"},(0,l.kt)("p",{parentName:"admonition"},(0,l.kt)("strong",{parentName:"p"},"Behind the scene"),", we keep tracks of the local changes by using a Proxy object. So the ripple is not a copy of the state object.\nIt works the same, but a proxy has some small differences still, like using an array with the Array.isArray function will not works as expected.")),(0,l.kt)("p",null,"When you use a ripple, the Lake will create a proxy object that will be used to keep track of the changes."),(0,l.kt)("p",null,"This way, a ripple even with complex structure with lots of nested objects will not be a performance issue.\nAs we keep track of changes, only the modified properties will be updated in one shot, or cancelled as per demand."),(0,l.kt)("p",null,"The real purpose is to limit to the maximum the need for the developer to implement a business logic inside the component.\nUse the component for rendering only."))}h.isMDXComponent=!0}}]);